data:text/html;base64,CjxodG1sPgo8L2h0bWw+CjxzY3JpcHQ+CnZhciBmcHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKZnBzLmlubmVySFRNTCA9ICJGUFM6IG4vYSI7CmZwcy5zdHlsZT0icG9zaXRpb246IGZpeGVkOyBsZWZ0OiAiICsgKHdpbmRvdy5pbm5lckhlaWdodC0yMCkgKyAicHg7IHRvcDogMTBweDsiOwpkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGZwcyk7CnZhciBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJjYW52YXMiKTsKdmFyIGdsID0gY2FudmFzLmdldENvbnRleHQoIndlYmdsMiIpOwpnbC5nZXRFeHRlbnNpb24oJ0VYVF9jb2xvcl9idWZmZXJfZmxvYXQnKQpvbmVycm9yID0gZnVuY3Rpb24oZSkge2FsZXJ0KGUpfQp2YXIgc2l6ZSA9IDUxMjsKY2FudmFzLndpZHRoID0gc2l6ZTsKY2FudmFzLmhlaWdodCA9IHNpemU7CmNhbnZhcy5zdHlsZSA9ICJpbWFnZS1yZW5kZXJpbmc6IHBpeGVsYXRlZDtwb3NpdGlvbjogZml4ZWQ7IGxlZnQ6IDA7IHRvcDogMDsgd2lkdGg6ICIgKyAod2luZG93LmlubmVySGVpZ2h0LTMwKSArICI7IGhlaWdodDogIiArICh3aW5kb3cuaW5uZXJIZWlnaHQtMzApICsgIjsgYmFja2dyb3VuZDogcmVkIjsKZ2wudmlld3BvcnQoMCwgMCwgc2l6ZSwgc2l6ZSk7CmRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoY2FudmFzKTsKCnZhciByZXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbnB1dCIpOwpyZXMuc3R5bGU9InBvc2l0aW9uOiBmaXhlZDsgbGVmdDogMHB4OyB0b3A6ICIgKyAod2luZG93LmlubmVySGVpZ2h0LTMwKSArICJweDsgaGVpZ2h0OiAzMHB4OyB3aWR0aDogIiArICh3aW5kb3cuaW5uZXJIZWlnaHQgLSAxMjApICsgIjsgdGV4dC1hbGlnbjogY2VudGVyIgpyZXMudmFsdWUgPSBzaXplOwp2YXIgcmVuZGVyRnJhbWUgPSB0cnVlOwp2YXIgbW91c2UgPSBbMTAwLCAxMDAsIGZhbHNlXTsKdmFyIHNlbnNpdGl2ZSA9IDEwMC47CmNhbnZhcy5vbm1vdXNlZG93biA9IGZ1bmN0aW9uKCkgewoJdmFyIHN0YXJ0ID0gWzEuLShldmVudC5jbGllbnRYLyhzZW5zaXRpdmUpKSwgMS4tKGV2ZW50LmNsaWVudFkvKHNlbnNpdGl2ZSkpXTsKCXZhciBwcyA9IFtjYW1EaXJbMF0sIGNhbURpclsxXV0KCWNhbnZhcy5vbm1vdXNlbW92ZSA9IGZ1bmN0aW9uKCkgewoJCW1vdXNlWzBdID0gMS4tKGV2ZW50LmNsaWVudFgvKHNlbnNpdGl2ZSkpOwoJCW1vdXNlWzFdID0gMS4tKChldmVudC5jbGllbnRZLyhzZW5zaXRpdmUpKSk7CgkJbW91c2VbMl0gPSB0cnVlOwoJCQoJCQoJCWNhbURpciA9IFtwc1swXSArIChzdGFydFswXS1tb3VzZVswXSksIHBzWzFdICsgKHN0YXJ0WzFdLW1vdXNlWzFdKV07CgkJCgkJcmVuZGVyRnJhbWUgPSB0cnVlOwoJfQoJY2FudmFzLm9ubW91c2V1cCA9IGZ1bmN0aW9uKCkgewoJCWNhbnZhcy5vbm1vdXNlbW92ZSA9IG51bGw7CgkJbW91c2VbMF0gPSAxLi0oZXZlbnQuY2xpZW50WC8oc2Vuc2l0aXZlKSk7CgkJbW91c2VbMV0gPSAxLi0oKGV2ZW50LmNsaWVudFkvKHNlbnNpdGl2ZSkpKTsKCQltb3VzZVsyXSA9IHRydWU7CgkJCgkJCgkJY2FtRGlyID0gW3BzWzBdICsgKHN0YXJ0WzBdLW1vdXNlWzBdKSwgcHNbMV0gKyAoc3RhcnRbMV0tbW91c2VbMV0pXTsKCQkKCQltb3VzZVsyXSA9IGZhbHNlOwoJfQp9CnJlcy5vbmtleWRvd24gPSBmdW5jdGlvbigpIHsKCWlmIChldmVudC5rZXkgPT0gIkVudGVyIikgewoJCXZhciBvbGQgPSBzaXplOwoJCXNpemUgPSBOdW1iZXIodGhpcy52YWx1ZSk7CgkJCgkJbW91c2VbMF0gPSBzaXplKihtb3VzZVswXS9vbGQpCgkJbW91c2VbMV0gPSBzaXplKihtb3VzZVsxXS9vbGQpCgkJCgkJZ2wudmlld3BvcnQoMCwgMCwgc2l6ZSwgc2l6ZSk7CgkJY2FudmFzLndpZHRoID0gc2l6ZTsKCQljYW52YXMuaGVpZ2h0ID0gc2l6ZTsKCQlyZW5kZXJGcmFtZSA9IHRydWU7CgkJT2JqZWN0LnZhbHVlcyhwYXNzZXMpLmZvckVhY2goZnVuY3Rpb24oZSkgewoJCQlnbC5iaW5kVGV4dHVyZShnbC5URVhUVVJFXzJELCBlLnRleHR1cmUpOwoJCQlnbC50ZXhJbWFnZTJEKGdsLlRFWFRVUkVfMkQsIDAsIGdsLlJHQkEzMkYsIHNpemUsIHNpemUsIDAsIGdsLlJHQkEsIGdsLkZMT0FULCBudWxsKTsKCQkJCgkJfSkKCX0KfQpkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHJlcyk7CnZhciBwbGF5aW5nID0gZmFsc2U7CnZhciBwbGF5QnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnV0dG9uIik7CnBsYXlCdXR0b24uc3R5bGU9InBvc2l0aW9uOiBmaXhlZDsgdG9wOiAiICsgKHdpbmRvdy5pbm5lckhlaWdodC0zMCkgKyAicHg7IGxlZnQ6ICIgKyAod2luZG93LmlubmVySGVpZ2h0IC0gMTIwKSArICJweDsgd2lkdGg6IDkwcHg7IGhlaWdodDogMzBweCI7CmRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQocGxheUJ1dHRvbik7CnBsYXlCdXR0b24uaW5uZXJIVE1MID0gIlBsYXkiOwpwbGF5QnV0dG9uLm9ubW91c2Vkb3duID0gZnVuY3Rpb24oKSB7Cgl0aGlzLmlubmVySFRNTCA9IHRoaXMuaW5uZXJIVE1MPT0iUGxheSI/IlBhdXNlIjoiUGxheSI7CglwbGF5aW5nID0gIXBsYXlpbmc7Ly90aGlzLmlubmVySFRNTD09IlBsYXkiOwp9CmZ1bmN0aW9uIHNoYWRlcihzcmMpIHsKCWZ1bmN0aW9uIGNyZWF0ZVNoYWRlcihzLCB0eXBlKSB7CgkJdmFyIHNoYWRlciA9IGdsLmNyZWF0ZVNoYWRlcih0eXBlKTsKCQlnbC5zaGFkZXJTb3VyY2Uoc2hhZGVyLCBzKTsKCQlnbC5jb21waWxlU2hhZGVyKHNoYWRlciwgZ2wuQ09NUElMRV9TVEFUVVMpOwoJCWlmIChnbC5nZXRTaGFkZXJQYXJhbWV0ZXIoc2hhZGVyLCBnbC5DT01QSUxFX1NUQVRVUykpIHJldHVybiBzaGFkZXI7CgkJYWxlcnQoZ2wuZ2V0U2hhZGVySW5mb0xvZyhzaGFkZXIpKTsKCQlnbC5kZWxldGVTaGFkZXIoc2hhZGVyKTsKCQlyZXR1cm4gZmFsc2U7Cgl9CgkKCXZhciB2c2hhZGVyID0gY3JlYXRlU2hhZGVyKGAjdmVyc2lvbiAzMDAgZXMKCXByZWNpc2lvbiBoaWdocCBmbG9hdDsKCWluIHZlYzIgcDsKCXZvaWQgbWFpbigpIHsKCQlnbF9Qb3NpdGlvbiA9IHZlYzQocCwgMSwgMSk7Cgl9YCwgZ2wuVkVSVEVYX1NIQURFUik7CgkKCXZhciBmc2hhZGVyID0gY3JlYXRlU2hhZGVyKGAjdmVyc2lvbiAzMDAgZXMKCXByZWNpc2lvbiBoaWdocCBmbG9hdDsKCW91dCB2ZWM0IGZyYWdDb2xvcjsKCWAgKyBzcmMsIGdsLkZSQUdNRU5UX1NIQURFUik7CgkKCXZhciBwcm9ncmFtID0gZ2wuY3JlYXRlUHJvZ3JhbSgpOwoJZ2wuYXR0YWNoU2hhZGVyKHByb2dyYW0sIHZzaGFkZXIpOwoJZ2wuYXR0YWNoU2hhZGVyKHByb2dyYW0sIGZzaGFkZXIpOwoJZ2wubGlua1Byb2dyYW0ocHJvZ3JhbSk7CglnbC51c2VQcm9ncmFtKHByb2dyYW0pOwoJCgl2YXIgcGxvYyA9IGdsLmdldEF0dHJpYkxvY2F0aW9uKHByb2dyYW0sICJwIik7Cgl2YXIgYnVmID0gIGdsLmNyZWF0ZUJ1ZmZlcigpOwoJZ2wuYmluZEJ1ZmZlcihnbC5BUlJBWV9CVUZGRVIsIGJ1Zik7CglnbC5idWZmZXJEYXRhKGdsLkFSUkFZX0JVRkZFUiwgbmV3IEZsb2F0MzJBcnJheShbLTEsIC0xLCAxLCAxLCAxLCAtMSwgLTEsIC0xLCAxLCAxLCAtMSwgMV0pLCBnbC5TVEFUSUNfRFJBVyk7CgkKCXZhciB2YW8gPSBnbC5jcmVhdGVWZXJ0ZXhBcnJheSgpOwoJZ2wuYmluZFZlcnRleEFycmF5KHZhbyk7CglnbC5lbmFibGVWZXJ0ZXhBdHRyaWJBcnJheShwbG9jKTsKCWdsLnZlcnRleEF0dHJpYlBvaW50ZXIocGxvYywgMiwgZ2wuRkxPQVQsIGZhbHNlLCAwLCAwKTsKCQoJcmV0dXJuIHByb2dyYW07Cn0KCmZ1bmN0aW9uIGNyZWF0ZVRleHR1cmUoKSB7Cgl2YXIgdGV4dHVyZSA9IGdsLmNyZWF0ZVRleHR1cmUoKTsKCWdsLmJpbmRUZXh0dXJlKGdsLlRFWFRVUkVfMkQsIHRleHR1cmUpOwogICAgCS8vZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX1dSQVBfUywgZ2wuQ0xBTVApOwogICAgCS8vZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX1dSQVBfVCwgZ2wuQyk7CiAgICAJZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX01JTl9GSUxURVIsIGdsLk5FQVJFU1QpOwogICAgCWdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9NQUdfRklMVEVSLCBnbC5ORUFSRVNUKTsKCXJldHVybiB0ZXh0dXJlOwp9CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKdmFyIHBhc3NlcyA9IHsKCXBhc3M6IHsKCQlzaGFkZXI6IHNoYWRlcihgCgkJdW5pZm9ybSBmbG9hdCBpVGltZTsKCQl1bmlmb3JtIHZlYzIgaVJlc29sdXRpb247CgkJdW5pZm9ybSB2ZWMzIGNhbVBvczsKCQl1bmlmb3JtIHZlYzMgY2FtRGlyOwoJCXVuaWZvcm0gaW50IGZsaXA7CgkJdW5pZm9ybSBpbnQgc3VwOwoJCXVuaWZvcm0gc2FtcGxlcjJEIGlucHV0MDsKI2RlZmluZSBQSSAzLjE0MTU5MjY1Mwpjb25zdCBmbG9hdCBtYXhEID0gMTAwMDAwMC47CmZsb2F0IGhhc2gxMyh2ZWMzIHAzKQp7CiAgICBwMyAgPSBmcmFjdChwMyAqIC4xMDMxKTsKICAgIHAzICs9IGRvdChwMywgcDMuenl4ICsgMzEuMzIpOwogICAgcmV0dXJuIGZyYWN0KChwMy54ICsgcDMueSkgKiBwMy56KTsKfQpmbG9hdCBoYXNoMTIodmVjMiBwKQp7Cgl2ZWMzIHAzICA9IGZyYWN0KHZlYzMocC54eXgpICogLjEwMzEpOwogICAgcDMgKz0gZG90KHAzLCBwMy55enggKyAzMy4zMyk7CiAgICByZXR1cm4gZnJhY3QoKHAzLnggKyBwMy55KSAqIHAzLnopOwp9CgpmbG9hdCBzcGhlcmUoaW4gdmVjMyBybywgaW4gdmVjMyByZCwgaW4gZmxvYXQgcikgewogICAgZmxvYXQgZCA9IC1kb3Qocm8sIHJkKTsKICAgIGZsb2F0IGRpc2MgPSByKnItZG90KHJvLCBybykrZCpkOwogICAgaWYgKGRpc2MgPCAwLjApIHJldHVybiBtYXhEOwogICAgZCAtPSBzcXJ0KGRpc2MpOwogICAgaWYgKGQgPiAwLjApIHJldHVybiBkOwogICAgcmV0dXJuIG1heEQ7Cn0KI2RlZmluZSBTKGNlbnRlciwgcmFkaXVzLCBjb2wsIG10KSB0bXAgPSBzcGhlcmUocm8tY2VudGVyLCByZCwgcmFkaXVzKTsgaWYgKHRtcCA8IGQpIHttYXQgPSBtdDtjb2xvciA9IGNvbDtkID0gdG1wOyBuPSgoKHJvK3JkKnRtcCktY2VudGVyKS9yYWRpdXMpO307IAojZGVmaW5lIFAoY2VudGVyLCBheGlzLCBmLCBjb2wsIG10KSB0bXAgPSAtKHJvLmF4aXMtY2VudGVyLmF4aXMpL3JkLmF4aXM7IGlmICh0bXAgPj0gMC4wICYmIHRtcCA8IGQpIHt2ZWMzIHAgPSBybytyZCp0bXA7IGlmICgoZikpIHttYXQgPSBtdDsgY29sb3IgPSBjb2w7IGQgPSB0bXA7IG4gPSB2ZWMzKDApOyBuLmF4aXMgPSAtc2lnbihyZC5heGlzKTt9fTsgCnN0cnVjdCBoaXQgewogICAgZmxvYXQgZDsKICAgIHZlYzMgbjsKICAgIHZlYzMgY29sb3I7CiAgICBpbnQgbWF0Owp9Owp2ZWMzIGhhc2gzMyh2ZWMzIHAzKQp7IC8vYnkgRGF2ZV9Ib3NraW5zIGh0dHBzOi8vd3d3LnNoYWRlcnRveS5jb20vdmlldy80ZGpTUlcKCXAzID0gZnJhY3QocDMgKiB2ZWMzKC4xMDMxLCAuMTAzMCwgLjA5NzMpKTsKICAgIHAzICs9IGRvdChwMywgcDMueXh6KzMzLjMzKTsKICAgIHJldHVybiBmcmFjdCgocDMueHh5ICsgcDMueXh4KSpwMy56eXgpOwp9CmhpdCBzY2VuZShpbiB2ZWMzIHJvLCBpbiB2ZWMzIHJkKSB7CiAgICB2ZWMzIG47CiAgICBmbG9hdCBkID0gbWF4RDsKICAgIGZsb2F0IHRtcDsKICAgIHZlYzMgY29sb3I7CiAgICBpbnQgbWF0ID0gMDsKICAgIFAodmVjMygwLjAsIDAuMCwgLTIuMCksIHosIG1heChhYnMocC54KSwgYWJzKHAueSkpIDwgMi4wLCB2ZWMzKDAuNSksIDIpCiAgICBQKHZlYzMoMC4wLCAwLjAsIDIuMCksIHosIG1heChhYnMocC54KSwgYWJzKHAueSkpIDwgMi4wLCB2ZWMzKDEuMCwgMC4yNSwgMC4yNSksIDEpCiAgICBQKHZlYzMoMC4wLCAtMi4wLCAwLjApLCB5LCBtYXgoYWJzKHAueCksIGFicyhwLnopKSA8IDIuMCwgdmVjMygwLjUpLCAyKQogICAgUCh2ZWMzKDAuMCwgMi4wLCAwLjApLCB5LCBtYXgoYWJzKHAueCksIGFicyhwLnopKSA8IDIuMCwgdmVjMygwLjUpLCAyKQogICAgUCh2ZWMzKC0yLjAsIDAuMCwgMC4wKSwgeCwgbWF4KGFicyhwLnopLCBhYnMocC55KSkgPCAyLjAsIHZlYzMoMC41KSwgMikKICAgIFAodmVjMygyLjAsIDAuMCwgMC4wKSwgeCwgbWF4KGFicyhwLnopLCBhYnMocC55KSkgPCAyLjAsIChpbnQoZmxvb3IocC55KjIuMCkpK2ludChmbG9vcihwLnoqMi4wKSkpJTI9PTA/dmVjMyhoYXNoMzMoZmxvb3IodmVjMyhwLnp5KjIuLCAwLjApKSoxMDAuKS54eSwgMSk6dmVjMygwLjUpLCAoaW50KGZsb29yKHAueSoyLjApKStpbnQoZmxvb3IocC56KjIuMCkpKSUyPT0wPzE6MikKICAgIFModmVjMygwLCAtMS4wLCAtMS41KSwgMC41LCB2ZWMzKDAuNSksIDApOwogICAgUyh2ZWMzKDAsIDAsIC0xLjUpLCAwLjUsIHZlYzMoMC41KSwgMCk7CiAgICBTKHZlYzMoMCwgMS4wLCAtMS41KSwgMC41LCB2ZWMzKDAuNSksIDApOwogICAgcmV0dXJuIGhpdChkLCBuLCBjb2xvciwgbWF0KTsKfQp2ZWMzIHJ1cyhpbiB2ZWMzIHNlZWQpIHsKICAgIHJldHVybiBub3JtYWxpemUoaGFzaDMzKHNlZWQpLTAuNSk7Cn0KY29uc3QgaW50IHNzID0gMTsKdmVjMyByZWYoaW4gdmVjMyByZCwgaW4gdmVjMyBoLCBpbiB2ZWMzIHJvLCBpbiB2ZWMzIHNlZWQpIHsKICAgIGZsb2F0IHcgPSBoYXNoMTMoc2VlZCoxMC4pKjAuMjU7CiAgICByZXR1cm4gbWl4KHJlZmxlY3QocmQsIGgpLCBub3JtYWxpemUoaCtydXMoc2VlZCkpLCB3KTsKfQp2ZWMzIGRpZihpbiB2ZWMzIHJkLCBpbiB2ZWMzIGgsIGluIHZlYzMgcm8pIHsKICAgIHJldHVybiBub3JtYWxpemUoaCtydXModmVjMyhyZCo1MjMuMjM1MjMraVRpbWUqMTAwLikpKTsKfQp2ZWMzIGdldENvbG9yKGluIHZlYzMgcm8sIGluIHZlYzMgcmQsIGluIHZlYzMgc2VlZCkgewogICAgdmVjMyBjID0gdmVjMygyLjApOwogICAgdmVjMyBvbjsKICAgIGZvciAoaW50IGkgPSAwOyBpIDwgNTA7IGkgKz0gMSkgewogICAgICAgIGZsb2F0IHYgPSAxLjA7CiAgICAgICAgaGl0IGggPSBzY2VuZShybywgcmQpOwogICAgICAgIGlmIChoLmQgPj0gbWF4RCkge2MgKj0gMS4wOyBicmVhazt9OwogICAgICAgIHJvID0gcm8rcmQqKGguZC0wLjAwMDEpOwogICAgICAgIGlmIChoLm1hdCA9PSAwKSByZCA9IHJlZihyZCwgaC5uLCBybywgc2VlZCk7CiAgICAgICAgaWYgKGgubWF0ID09IDEpIHtjICo9IGguY29sb3I7IGJyZWFrO30KICAgICAgICBpZiAoaC5tYXQgPT0gMikgcmQgPSBkaWYocmQsIGgubiwgcm8pOwogICAgICAgIGMqPSBoLmNvbG9yOwogICAgfQogICAgcmV0dXJuIGM7Ly9zY2VuZShybywgcmQpLmQgPCAxMDAuP3ZlYzMoMCk6dmVjMygxKTsKfQp2ZWMyIGhhc2gyMyh2ZWMzIHAzKQp7CglwMyA9IGZyYWN0KHAzICogdmVjMyguMTAzMSwgLjEwMzAsIC4wOTczKSk7CiAgICBwMyArPSBkb3QocDMsIHAzLnl6eCszMy4zMyk7CiAgICByZXR1cm4gZnJhY3QoKHAzLnh4K3AzLnl6KSpwMy56eSk7Cn0KCnZlYzMgaW1hZ2UoaW4gdmVjMiBmcmFnQ29vcmQpIHsKCXZlYzIgcyA9IHN1cCA9PSAwP3ZlYzIoMCk6aGFzaDIzKHZlYzMoZnJhZ0Nvb3JkLnh5LCBpVGltZSkpOwoJdmVjMiB1diA9ICgoZnJhZ0Nvb3JkLnh5K3MpL2lSZXNvbHV0aW9uLnh5KS0wLjU7CgkvL3ZlYzIgbW91c2UgPSAoaU1vdXNlLnh5L2lSZXNvbHV0aW9uLnh5KSp2ZWMyKFBJKjIuMCwgUEkpOwoJdmVjMyBybyA9IGNhbVBvczsvL3ZlYzMoc2luKG1vdXNlLngpKnNpbihtb3VzZS55KSwgY29zKG1vdXNlLngpKnNpbihtb3VzZS55KSwgY29zKG1vdXNlLnkpKSoyLjA7Cgl2ZWMzIHJkID0gY2FtRGlyOwoJaWYgKGZsaXAgPiAwKSB1diA9IC11djsKCXZlYzMgcHggPSB2ZWMzKG5vcm1hbGl6ZSh2ZWMyKHJkLnksIC1yZC54KSksIDApOy8vKHZlYzMobm9ybWFsaXplKHZlYzIocmQueSwgLXJkLngpKSwgMC4wKSk7Cgl2ZWMzIHB5ID0gY3Jvc3MocHgsIHJkKTsKCXJkID0gbm9ybWFsaXplKHJkK3B4KnV2LngrcHkqdXYueSk7CglyZXR1cm4gZ2V0Q29sb3Iocm8sIHJkLCB2ZWMzKHV2Lnh5LCBpVGltZSkqMTAwLik7Cn0KY29uc3QgaW50IHRpbGVTaXplID0gNTEyOwoKdm9pZCBtYWluKCkgewoJaWYgKHN1cCAhPSAwKSB7CgkJdmVjNCBjID0gdGV4ZWxGZXRjaChpbnB1dDAsIGl2ZWMyKGdsX0ZyYWdDb29yZC54eSksIDApOwoJCWlmIChjLncgPT0gMC4wKSBjID0gdmVjNCgwKTsKCQlpdmVjMiBmYyA9IGl2ZWMyKGdsX0ZyYWdDb29yZC54eSk7CgkJaXZlYzIgdGlsZSA9IGZjL3RpbGVTaXplOwoJCWludCB0aWxlSUQgPSB0aWxlLngrKHRpbGUueSooaW50KGlSZXNvbHV0aW9uLngpL3RpbGVTaXplKSk7CgkJaW50IHNpemUgPSBpbnQoaVJlc29sdXRpb24ueCkvdGlsZVNpemU7CgkJaWYgKHRpbGVJRCAhPSAoaW50KGlUaW1lKjAuMDAwNSklKHNpemUqc2l6ZSkpKSB7CgkJCWZyYWdDb2xvciA9IHRleGVsRmV0Y2goaW5wdXQwLCBpdmVjMihnbF9GcmFnQ29vcmQueHkpLCAwKTsKCQkJcmV0dXJuOwoJCX0KCQl2ZWM0IGNvbCA9IHZlYzQoaW1hZ2UoZ2xfRnJhZ0Nvb3JkLnh5KSwgMSk7CgkJZnJhZ0NvbG9yID0gYyArIGNvbDsKCX0gZWxzZSB7CgkJdmVjMyBjb2wgPSBpbWFnZShnbF9GcmFnQ29vcmQueHkpOwoJCWZyYWdDb2xvciA9IHZlYzQoY29sLCAwLjApOwoJfQp9CgoKCQlgKSwKCQlpbnB1dHM6IFsicGFzczEiXQoJfSwKCXBhc3MxOiB7CgkJc2hhZGVyOiBzaGFkZXIoYAoJCXVuaWZvcm0gc2FtcGxlcjJEIGlucHV0MDsKCQl1bmlmb3JtIGZsb2F0IGlUaW1lOwoJCXZlYzIgaGFzaDIzKHZlYzMgcDMpCgkJewoJCSAgICBwMyA9IGZyYWN0KHAzICogdmVjMyguMTAzMSwgLjEwMzAsIC4wOTczKSk7CgkJICAgIHAzICs9IGRvdChwMywgcDMueXp4KzMzLjMzKTsKCQkgICAgcmV0dXJuIGZyYWN0KChwMy54eCtwMy55eikqcDMuenkpOwoJCX0KCQl2b2lkIG1haW4oKSB7CgkJCXZlYzIgciA9IGhhc2gyMyh2ZWMzKGdsX0ZyYWdDb29yZC54eSwgaVRpbWUqMTAuKSktMC41OwoJCQlmcmFnQ29sb3IgPSB0ZXhlbEZldGNoKGlucHV0MCwgaXZlYzIoZ2xfRnJhZ0Nvb3JkKSwgMCk7CgkJCS8vciAqPSA1MC4vKGZyYWdDb2xvci53KTsKCQkJLy92ZWM0IHAyID0gdGV4ZWxGZXRjaChpbnB1dDAsIGl2ZWMyKGdsX0ZyYWdDb29yZC54eStyKSwgMCk7CgkJCS8vcDIueHl6ID0gcG93KHAyLnh5eiwgdmVjMygyKSkqMC4yOwoJCQkvL2ZyYWdDb2xvciA9IG1peChmcmFnQ29sb3IsIHAyLCAwLjUpOwoJCQkvL2ZyYWdDb2xvciArPSB0ZXhlbEZldGNoKGlucHV0MCwgaXZlYzIoZ2xfRnJhZ0Nvb3JkK2hhc2gyMyh2ZWMzKGdsX0ZyYWdDb29yZC54eSwgaVRpbWUpKSksIDApOwoJCX0KCQlgKSwKCQlpbnB1dHM6IFsicGFzcyJdCgl9LAoJbWFpbjogewoJCXNoYWRlcjogc2hhZGVyKGAKCQl1bmlmb3JtIHNhbXBsZXIyRCBpbnB1dDA7CgkJdm9pZCBtYWluKCkgewoJCQlmcmFnQ29sb3IgPSB0ZXhlbEZldGNoKGlucHV0MCwgaXZlYzIoZ2xfRnJhZ0Nvb3JkKSwgMCk7CgkJCWlmIChmcmFnQ29sb3IudyAhPSAwLjApIGZyYWdDb2xvci54eXogLz0gZnJhZ0NvbG9yLnc7CgkJCWZyYWdDb2xvci54eXogPSAxLi1leHAoLWZyYWdDb2xvci54eXoqMi4wKTsKCQkJZnJhZ0NvbG9yLncgPSAxLjsKCQl9CgkJYCksCgkJaW5wdXRzOiBbInBhc3MiXQoJfQp9OwkKCQoJCgkKCQoJCgkKCQoJCgkKCQoJCgkKCQoJCgkKCQoJCgkKCQp2YXIgc3VwID0gZmFsc2U7CmZ1bmN0aW9uIHNldFVuaWZvcm1zKGxvY3MpIHsKCWdsLnVuaWZvcm0xZihsb2NzWyJpVGltZSJdLCBmcmFtZSk7CglnbC51bmlmb3JtMmZ2KGxvY3NbImlSZXNvbHV0aW9uIl0sIFtzaXplLCBzaXplXSk7CglnbC51bmlmb3JtMWkobG9jc1siZmxpcCJdLCBmbGlwKTsKCWdsLnVuaWZvcm0xaShsb2NzWyJzdXAiXSwgc3VwKTsKCWdsLnVuaWZvcm0zZnYobG9jc1siY2FtUG9zIl0sIGNhbVBvcyk7CglnbC51bmlmb3JtM2Z2KGxvY3NbImNhbURpciJdLCBjYW1Ob3JtKTsKfQpmdW5jdGlvbiBpbml0KCkgewoJT2JqZWN0LmtleXMocGFzc2VzKS5mb3JFYWNoKGZ1bmN0aW9uKGUpIHsKCQl2YXIgcHJvZ3JhbSA9IChwYXNzZXNbZV0uc2hhZGVyKTsKCQlnbC51c2VQcm9ncmFtKHByb2dyYW0pOwoJCWlmIChlICE9ICJtYWluIikgewoJCQl2YXIgdGV4dHVyZSA9IGNyZWF0ZVRleHR1cmUoKTsKCQkJZ2wudGV4SW1hZ2UyRChnbC5URVhUVVJFXzJELCAwLCBnbC5SR0JBMzJGLCBzaXplLCBzaXplLCAwLCBnbC5SR0JBLCBnbC5GTE9BVCwgbnVsbCk7CgkJCXZhciBmYiA9IGdsLmNyZWF0ZUZyYW1lYnVmZmVyKCk7CgkJCXBhc3Nlc1tlXS5mcmFtZWJ1ZmZlciA9IGZiOwoJCQlwYXNzZXNbZV0udGV4dHVyZSA9IHRleHR1cmU7CgkJCWdsLmJpbmRGcmFtZWJ1ZmZlcihnbC5GUkFNRUJVRkZFUiwgZmIpOwoJCQlnbC5mcmFtZWJ1ZmZlclRleHR1cmUyRChnbC5GUkFNRUJVRkZFUiwgZ2wuQ09MT1JfQVRUQUNITUVOVDAsIGdsLlRFWFRVUkVfMkQsIHRleHR1cmUsIDApOwoJCX0KCQl2YXIgaW5wdXRzID0gcGFzc2VzW2VdLmlucHV0czsKCQlwYXNzZXNbZV0ubG9jcyA9IHt9OwoJCWZvciAodmFyIGkgPSAwOyBpIDwgaW5wdXRzLmxlbmd0aDsgaSArPSAxKSB7CgkJCXZhciBuYW1lID0gImlucHV0IiArIGk7ICAvL25hbWUgb2YgdGhlIHRleHR1cmUgaW4gc2hhZGVyCgkJCXZhciBsb2MgPSBnbC5nZXRVbmlmb3JtTG9jYXRpb24ocHJvZ3JhbSwgbmFtZSk7IC8vbG9jYXRpb24gb2YgdGV4dHVyZSBpbiBzaGFkZXIKCQkJZ2wudW5pZm9ybTFpKGxvYywgaSk7CgkJCXBhc3Nlc1tlXS5sb2NzW25hbWVdID0gbG9jOwoJCX0KCQlwYXNzZXNbZV0udW5pZm9ybXMgPSB7CgkJCWlUaW1lOiBnbC5nZXRVbmlmb3JtTG9jYXRpb24ocHJvZ3JhbSwgImlUaW1lIiksCgkJCWlSZXNvbHV0aW9uOiBnbC5nZXRVbmlmb3JtTG9jYXRpb24ocHJvZ3JhbSwgImlSZXNvbHV0aW9uIiksCgkJCWZsaXA6IGdsLmdldFVuaWZvcm1Mb2NhdGlvbihwcm9ncmFtLCAiZmxpcCIpLAoJCQljYW1Qb3M6IGdsLmdldFVuaWZvcm1Mb2NhdGlvbihwcm9ncmFtLCAiY2FtUG9zIiksCgkJCWNhbURpcjogZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKHByb2dyYW0sICJjYW1EaXIiKSwKCQkJc3VwOiBnbC5nZXRVbmlmb3JtTG9jYXRpb24ocHJvZ3JhbSwgInN1cCIpCgkJfQoJCWlmIChlID09ICJtYWluIikgewoJCQlwYXNzZXNbZV0ucmVuZGVyID0gZnVuY3Rpb24oKSB7CgkJCQlmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuaW5wdXRzLmxlbmd0aDsgaSArPSAxKSB7CgkJCQkJdmFyIGlwYXNzID0gcGFzc2VzW3RoaXMuaW5wdXRzW2ldXTsKCQkJCQlnbC5hY3RpdmVUZXh0dXJlKGdsLlRFWFRVUkUwICsgaSk7CgkJCQkJZ2wuYmluZFRleHR1cmUoZ2wuVEVYVFVSRV8yRCwgaXBhc3MudGV4dHVyZSk7CgkJCQl9CgkJCQkKCQkJCWdsLnVzZVByb2dyYW0odGhpcy5zaGFkZXIpOwoJCQkJc2V0VW5pZm9ybXModGhpcy51bmlmb3Jtcyk7CgkJCQlnbC5kcmF3QXJyYXlzKGdsLlRSSUFOR0xFUywgMCwgNik7CgkJCX0KCQl9IGVsc2UgewoJCQlwYXNzZXNbZV0ucmVuZGVyID0gZnVuY3Rpb24oKSB7CgkJCQlmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuaW5wdXRzLmxlbmd0aDsgaSArPSAxKSB7CgkJCQkJdmFyIGlwYXNzID0gcGFzc2VzW3RoaXMuaW5wdXRzW2ldXTsKCQkJCQlnbC5hY3RpdmVUZXh0dXJlKGdsLlRFWFRVUkUwICsgaSk7CgkJCQkJZ2wuYmluZFRleHR1cmUoZ2wuVEVYVFVSRV8yRCwgaXBhc3MudGV4dHVyZSk7CgkJCQl9CgkJCQlnbC5iaW5kRnJhbWVidWZmZXIoZ2wuRlJBTUVCVUZGRVIsIHRoaXMuZnJhbWVidWZmZXIpOwoJCQkJZ2wudXNlUHJvZ3JhbSh0aGlzLnNoYWRlcik7CgkJCQlzZXRVbmlmb3Jtcyh0aGlzLnVuaWZvcm1zKTsKCQkJCWdsLmRyYXdBcnJheXMoZ2wuVFJJQU5HTEVTLCAwLCA2KTsKCQkJCWdsLmJpbmRGcmFtZWJ1ZmZlcihnbC5GUkFNRUJVRkZFUiwgbnVsbCk7CgkJCX0KCQl9Cgl9KQoJZ2wuYmluZEZyYW1lYnVmZmVyKGdsLkZSQU1FQlVGRkVSLCBudWxsKTsKfQppbml0KCk7CnZhciBmcmFtZSA9IDA7CnZhciBrZXlzID0ge307CndpbmRvdy5vbmtleWRvd24gPSBmdW5jdGlvbigpIHsKCWlmIChldmVudC5rZXkgPT0gImsiKSB7CgkJZG9jdW1lbnQud3JpdGUoW2NhbVBvcywgY2FtRGlyLCBjYW1Ob3JtXSk7Cgl9CglpZiAoZXZlbnQua2V5ID09ICJBcnJvd1VwIikgewoJCXNwZWVkICo9IDIuMDsKCX0KCWlmIChldmVudC5rZXkgPT0gIkFycm93RG93biIpIHsKCQlzcGVlZCAqPSAwLjU7Cgl9CglpZiAoZXZlbnQua2V5ID09ICJtIikgewoJCXN1cCA9ICFzdXA7CgkJZnJhbWUgPSAwOwoJfQoJa2V5c1tldmVudC5rZXkudG9VcHBlckNhc2UoKV0gPSB0cnVlOwp9CndpbmRvdy5vbmtleXVwID0gZnVuY3Rpb24oKSB7CglkZWxldGUga2V5c1tldmVudC5rZXkudG9VcHBlckNhc2UoKV0KfQp2YXIgY2FtUG9zID0gWzEuOTgyNDc4NzQxMTc0OTcsLTEuOTE5NzIwNDE3MDU4ODQ3OCwtMS43ODk4MDEwMjkxMTY3ODA1XTsKdmFyIGNhbURpciA9IFstMC45MDk5OTk5OTk5OTk5OTkzLDEuNDgwNzVdOwp2YXIgY2FtTm9ybSA9IFswLCAwLCAwXQp2YXIgc3BlZWQgPSAwLjE7CmZ1bmN0aW9uIGNyb3NzKGEsIGIpIHsKCXJldHVybiBbYVsxXSAqIGJbMl0gLSBhWzJdICogYlsxXSwgCgkgICAgICAgIGFbMl0gKiBiWzBdIC0gYVswXSAqIGJbMl0sIAoJICAgICAgICBhWzBdICogYlsxXSAtIGFbMV0gKiBiWzBdXQp9CmZ1bmN0aW9uIG5vcm1hbGl6ZShhKSB7Cgl2YXIgbCA9IE1hdGguc3FydChhWzBdKmFbMF0rYVsxXSphWzFdK2FbMl0qYVsyXSk7CglyZXR1cm4gW2FbMF0vbCwgYVsxXS9sLCBhWzJdL2xdOwp9CnZhciBmbGlwOwp2YXIgZnJhbWVzID0gMDsKdmFyIHN0YXJ0ID0gRGF0ZS5ub3coKTsKZnVuY3Rpb24gbG9vcCgpIHsKCWlmIChEYXRlLm5vdygpLXN0YXJ0ID4gMTAwMCkgewoJCWZwcy5pbm5lckhUTUwgPSAiZnBzOiAiICsgTWF0aC5mbG9vcihmcmFtZXMpOwoJCWZyYW1lcyA9IDA7CgkJc3RhcnQgPSBEYXRlLm5vdygpOwoJfQoJdmFyIGNkID0gW2NhbURpclswXSwgY2FtRGlyWzFdXTsKCWZsaXAgPSBNYXRoLmFicyhNYXRoLmZsb29yKChjZFsxXS9NYXRoLlBJKSArIDEpKSUyIDwgMTsKCXZhciBub3JtYWwgPSBub3JtYWxpemUoW01hdGguc2luKGNkWzBdKSpNYXRoLnNpbihjZFsxXSksTWF0aC5jb3MoY2RbMF0pKk1hdGguc2luKGNkWzFdKSxNYXRoLmNvcyAoY2RbMV0pXSk7Cgl2YXIgc2lkZSA9IG5vcm1hbGl6ZShjcm9zcyhub3JtYWwsIFswLCAwLCAxXSkpOwoJY2FtTm9ybSA9IG5vcm1hbDsKCXZhciBtb3ZlbWVudCA9IFswLCAwLCAwXTsKCWlmIChrZXlzWyJXIl0pIHsKCQltb3ZlbWVudFswXSArPSBub3JtYWxbMF07CgkJbW92ZW1lbnRbMV0gKz0gbm9ybWFsWzFdOwoJCW1vdmVtZW50WzJdICs9IG5vcm1hbFsyXTsKCQlyZW5kZXJGcmFtZSA9IHRydWU7Cgl9CglpZiAoa2V5c1siUyJdKSB7CgkJbW92ZW1lbnRbMF0gLT0gbm9ybWFsWzBdOwoJCW1vdmVtZW50WzFdIC09IG5vcm1hbFsxXTsKCQltb3ZlbWVudFsyXSAtPSBub3JtYWxbMl07CgkJcmVuZGVyRnJhbWUgPSB0cnVlOwoJfQoJCglpZiAoa2V5c1siRCJdICYmIHNpZGUpIHsKCQltb3ZlbWVudFswXSArPSBzaWRlWzBdOwoJCW1vdmVtZW50WzFdICs9IHNpZGVbMV07CgkJbW92ZW1lbnRbMl0gKz0gc2lkZVsyXTsKCQlyZW5kZXJGcmFtZSA9IHRydWU7Cgl9CglpZiAoa2V5c1siQSJdICYmIHNpZGUpIHsKCQltb3ZlbWVudFswXSAtPSBzaWRlWzBdOwoJCW1vdmVtZW50WzFdIC09IHNpZGVbMV07CgkJbW92ZW1lbnRbMl0gLT0gc2lkZVsyXTsKCQlyZW5kZXJGcmFtZSA9IHRydWU7Cgl9CglpZiAoa2V5c1siU0hJRlQiXSkgewoJCW1vdmVtZW50WzJdIC09IDE7CgkJcmVuZGVyRnJhbWUgPSB0cnVlOwoJfQoJaWYgKGtleXNbIiAiXSkgewoJCW1vdmVtZW50WzJdICs9IDE7CgkJcmVuZGVyRnJhbWUgPSB0cnVlOwoJfQoJbW92ZW1lbnQgPSBub3JtYWxpemUobW92ZW1lbnQpOwoJaWYgKCEoTnVtYmVyLmlzTmFOKG1vdmVtZW50WzBdKSB8fCBOdW1iZXIuaXNOYU4obW92ZW1lbnRbMV0pIHx8IE51bWJlci5pc05hTihtb3ZlbWVudFsyXSkpKSB7CgkJY2FtUG9zWzBdICs9IG1vdmVtZW50WzBdKnNwZWVkOwoJCWNhbVBvc1sxXSArPSBtb3ZlbWVudFsxXSpzcGVlZDsKCQljYW1Qb3NbMl0gKz0gbW92ZW1lbnRbMl0qc3BlZWQ7Cgl9CglpZiAocGxheWluZyB8fCBmcmFtZSA9PSAwIHx8IHJlbmRlckZyYW1lKSB7CgkJT2JqZWN0LmtleXMocGFzc2VzKS5mb3JFYWNoKGZ1bmN0aW9uKGUpIHsKCQkJdmFyIHBhc3MgPSBwYXNzZXNbZV07CgkJCXBhc3MucmVuZGVyKCk7CgkJfSkKCQlmcmFtZSArPSAxOwoJCXJlbmRlckZyYW1lID0gZmFsc2U7Cgl9CglmcmFtZXMgKz0gMTsKCXdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUobG9vcCk7Cn0KbG9vcCgpOwo8L3NjcmlwdD4=
